### Create Presentation Request
The Verifier starts the process in 
step 1 of the [AnonCreds Presentation Data Flow](#anoncreds-presentation-data-flow)
by creating and sending a presentation request to the Holder.

The presentation request provides information about the required attributes and predicates to be revealed
by the Holder as well as information about the credential revocation status and other restrictions.

The presentation request is generated by the Verifier in JSON format:
```json
{
    "name": string,
    "version": string,
    "nonce": string, 
    "requested_attributes": { 
        "<attr_referent>": <attr_info>, 
        ...,
    },
    "requested_predicates": { 
        "<predicate_referent>": <predicate_info>, 
        ...,
     },
    "non_revoked": Optional<non_revoc_interval>, 
    "ver": Optional<str>
}
```
* `name` is a string, the name of the presentation request 
* `version` is a string, the version of the presentation request 
* `nonce` is a string, the nonce generated by the Verifier, 
presents a decimal number (use `indy_generate_nonce` function to generate a correct nonce as 80-bit number)
* `requested_attributes` specify the set of requested attributes
  * `attr_referent` is a proof-request local identifier for the requested attribute.
  * `attr_info` describes a requested attribute, see [attr_info](#attr_info)
* `requested_predicates` specify the set of requested predicates
  * `predicate_referent` is a proof-request local identifier for the requested predicate.
  * `predicate_info` describes a requested attribute predicate, see , see [predicate_info](#predicate_info)
* `non_revoked` specifies an optional non-revocation interval `non_revoc_interval`, see [Request Non-Revocation Proofs](#request-non-revocation-proofs) section.
  If specified, the Holder must proof non-revocation for date in this interval for each attribute. The interval
  applies to every attribute and predicate but can be overridden on attribute level.
* `ver` is an optional string, specifies the proof request version. 
  * Set `ver` to "1.0" or omit to use unqualified identifiers for restrictions
  * Set `ver` to "2.0" to use fully qualified identifiers for restrictions

<a id="attr_info"></a> `attr_info` has the following format:

```json
{
    "name": Optional<string>,
    "names": Optional<[string, string]>,
    "restrictions": Optional<wql query>,
    "non_revoked": Optional<non_revoc_interval>,
}
```        
* `name` is an (optional) string, the name of the attribute, case insensitive and ignore spaces
* `names` is an (optional) string array , the names of the attribute, case insensitive and ignore spaces
  * NOTES: 
    * use either `name` or `names`, not both and not none of them.
    * use `names` to specify several attributes that have to match a single credential.
* `restrictions`  is an (optional) Json - Wql query filter for credentials searching, see [wql_query](#wql_query)
* `non_revoked` specifies an optional non-revocation interval `non_revoc_interval`, see [Request Non-Revocation Proofs](#request-non-revocation-proofs) section. 
  If specified, the Holder must proof non-revocation for date in this interval for this attribute, this interval overrides the
  proof level interval.

<a id="predicate_info"></a> `predicate_info` has the following format:

```json
{
    "name": string, 
    "p_type": string, 
    "p_value": int, 
    "restrictions": Optional<wql query>, 
    "non_revoked": Optional<non_revoc_interval>, 
}
```
* `name` is an (optional) string, the name of the predicate, case insensitive and ignore spaces
* `p_type` is a string, the type of the predicate, with possible types  [">=", ">", "<=", "<"]
* `p_value` is an integer value, the value of the predicate
* `restrictions`  is an (optional) Json - Wql query filter for credentials searching, see [wql_query](#wql_query)
* `non_revoked` specifies an optional non-revocation interval `non_revoc_interval`, see [Request Non-Revocation Proofs](#request-non-revocation-proofs) section.
  If specified, the Holder must proof non-revocation for date in this interval for this predicate, this interval overrides the
  proof level interval.

#### Request Non-Revocation Proofs

The presentation request JSON item `non_revoc_interval` allows the [[ref:
verifier]] to define an acceptable non-revocation interval for a requested
attribute(s) / predicate(s) with the following timestamps:

```json
{
    "from": Optional<int>, 
    "to": Optional<int>, 
}
```

* `from` is a unsigned long long value, the timestamp of interval beginning,
  presented as total number of seconds from Unix Epoch. 
* `to` is a unsigned long long value, the timestamp of interval end, presented
  as total number of seconds from Unix Epoch.

As noted in the examples above, the `non-revoked` item be may at the outer level
of the presentation request such that it applies to all attributes and
predicates, or at the attribute/predicate level, applying only to specific
attributes and/or predicates.

The use of a "non-revoke interval" is intended to have the semantic meaning that
the [[ref: verifier]] will accept a non-revocation Proof (NRP) from any point in
the `from` to `to` interval. The intention is that by being as flexible as the
business rules allow, the [[ref: holder]] and/or [[ref: verifier]] may have
cached [[ref: VDR]] revocation data such that they don't have to go to the
[[ref: VDR]] to get additional [[ref: RevRegEntry]] data. In practice, the use
of an interval here is not well understood and tends to cause confusion amongst
presentation request developers. The AnonCreds community recommends always using
matching `to` and `from` values (see [Aries RFC 0441 Present Proof Best
Practices](https://github.com/hyperledger/aries-rfcs/tree/main/concepts/0441-present-proof-best-practices#semantics-of-non-revocation-interval-endpoints)).

While one would expect the `to` value to be the current time ("Prove the
credential is not revoked right now"), its inclusion allows the [[ref:
verifier]] to ask for a NRP sometime in the past. This addresses use cases such
as "Prove that your car insurance policy was not revoked on June 12, 2021 when
the accident occurred."

#### WQL Query

The `restrictions` on each attribute/predicate defines a query filter in [[ref:
Wallet Query Language]] (WQL) that is used to search the [[ref: holder]] wallet
(storage) for candidate credentials that meet the restrictions. WQL is not
required in an AnonCreds implementation, but the function it performs is
required. That is, the [[ref: holder]] must scan the credentials it holds to
find the ones that satisfy the requirements defined in the presentation request.

The WQL specification can be found in
[indy-sdk/docs/design/011-wallet-query-language/README.md](https://github.com/hyperledger/indy-sdk/blob/master/docs/design/011-wallet-query-language/README.md)

Wallets can be searched and filtered using a simple, JSON-based query language. 
WQL is inspired by MongoDB's query syntax, and can be mapped to SQL, GraphQL, 
and other query languages supported by storage backends.

The list of allowed keys that can be combined into complex queries includes:

```json
    "schema_id": <credential schema id>,
    "schema_issuer_did": <credential schema issuer did>,
    "schema_name": <credential schema name>,
    "schema_version": <credential schema version>,
    "issuer_did": <credential issuer did>,
    "cred_def_id": <credential definition id>,
    "rev_reg_id": <credential revocation registry id>, // "None" as string if not present
    // the following keys can be used for every `attribute name` in credential.
    "attr::<attribute name>::marker": "1", - to filter based on existence of a specific attribute
    "attr::<attribute name>::value": <attribute raw value>, - to filter based on value of a specific attribute
```

#### WQL Query Examples

1. Get all credentials where subject like `Acme%` and issue_date `>` specified data. 
  (Note: the name of the `issue_date` tag begins with a tilde, 
  telling the wallet to store its value unencrypted, which makes the `$gt` operator possible.)
    ```json
    "restrictions": {
        "~subject": {"$like": "Acme%"},
        "~issue_date": {"$gt": 2022-04-26}
    }
    ```

2. Get all credentials where `schema_id` is contained in (a, b, c) and `issuer_id` in (d, e, f).
    ```json
    "restrictions": {
        "schema_id": {
            "$in": ["a", "b", "c"]
        },
        "issuer_id": {
            "$in": ["d", "e", "f"]
        }
    }
    ```

3. Get all credentials where 
   1. `cred_def_id` is "NcYxi...TAG_1" AND `issuer_did` is "NcYxiDXkpYi6ov5FcYDi1e" OR 
   2. `cred_def_id` is "CnEDk...TAG_1" AND `issuer_did` is "CnEDk9HrMnmiHXEV1WFgbVCRteYnPqsJwrTdcZaNhFVW".
   
    ```json
    "restrictions": [
        {
            "cred_def_id": "NcYxiDXkpYi6ov5FcYDi1e:3:CL:NcYxiDXkpYi6ov5FcYDi1e:2:gvt:1.0:TAG_1",
            "issuer_did": "NcYxiDXkpYi6ov5FcYDi1e"
        },
        {
            "cred_def_id": "CnEDk9HrMnmiHXEV1WFgbVCRteYnPqsJwrTdcZaNhFVW:3:CL:CnEDk9HrMnmiHXEV1WFgbVCRteYnPqsJwrTdcZaNhFVW:2:gvt:1.0:TAG_1",
            "issuer_did": "CnEDk9HrMnmiHXEV1WFgbVCRteYnPqsJwrTdcZaNhFVW"
        }
    ]
    ```

#### Example of a complete presentation request
```json
{   
    "nonce": "verifierNonce",
    "name": "pres_req_1",
    "version": "0.1",
    "requested_attributes": {
        "attr1_referent": {
            "name": "name"
        },
        "attr2_referent": {
            "name": "sex"
        },
        "attr3_referent": {
            "name": "phone"
        },
        "attr4_referent": {
            "names": ["name", "height"],
            "restrictions":
            {
                "cred_def_id": "NcYxiDXkpYi6ov5FcYDi1e:3:CL:NcYxiDXkpYi6ov5FcYDi1e:2:gvt:1.0:TAG_1",
                "issuer_did": "NcYxiDXkpYi6ov5FcYDi1e"
            }
        }
    },
    "requested_predicates": {
        "pred1_referent": {
            "name": "age",
            "p_type": ">=",
            "p_value": 18,
            "restrictions": [{
                "issuer_did": "did",
                "schema_id": "id"
            }]
        }
    },
    "non_revoked": {
        "from": 1650876280,
        "to": 1682405051
    }
}
```

In step 2 of the [AnonCreds Presentation Data Flow](#anoncreds-presentation-data-flow), 
the Verifier sends the presentation request to the Holder.
